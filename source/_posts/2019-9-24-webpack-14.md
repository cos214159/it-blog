---
title: webpack 筆記 (14) - Babel
date: 2019-09-24 16:11:25
tags: 
  - webpack
categories: 前端
---

Babel 是能夠將 ECMAScript 2015+ 語法編譯成 ES5，得以在較多瀏覽器底下執行的工具。

## 安裝套件
```
npm install --save-dev @babel/core @babel/cli @babel/preset-env
npm install --save @babel/polyfill
```

底下這三個套件，主要是在開發中的階段會使用到
* @babel/cli : 可以讓我們在終端機上使用 babel
* @babel/core : babel 的核心程式碼
* @babel/preset-env : 這個在後續會講到

比較特別的是這個套件 @babel/polyfill 這是在發布的環境下還會使用的套件
* @babel/polyfill

## 開始進行編譯
首先先建立一個有 ES6 語法的檔案，es6.js，可以看到裡面有用到 const、let 的宣告關鍵字，還有箭頭函式

``` JavaScript
const fn = () => 1;
let a = 1;
```
而這些 ES6 的語法因為他是不能運行在所有的瀏覽器，所以這時候我們要依靠 babel 去把這些 ES6 的語法轉成 ES5，這樣就得以運行在大部分的瀏覽器底下囉。

這個時候因為我們有安裝了 @babel/core 以及 @babel/cli 所以可以直接在終端機使用 babel 的功能，那我們先來使用以下指令。

```
npx babel source/es6.js
```
![Alt text](https://firebasestorage.googleapis.com/v0/b/it-blog-a274d.appspot.com/o/babel_1.png?alt=media&token=b8137af7-456c-4769-87c3-bda87da7e42c)

這個時候編譯出來的結果，在上圖藍框的地方，我們會發現到他跟原本的程式碼長的一模一樣，難不成是 babel 失靈了 ? 在他的官方文件上有寫到這麼一段

Since we haven’t told it to apply any transformations yet, the output code will be identical to the input (exact code styling is not preserved). We can specify what transformations we want by passing them as options.

意思大概是說，我們只是有讓 babel 去解析這段 code，但是並沒有特別註記，要怎麼把 let、const 以及箭頭函式轉成 ES5 的程式碼，所以輸出結果會跟原本是一致的，就是等於沒做的意思。

這個時候必須仰賴 Plugins 的幫忙，https://babeljs.io/docs/en/plugins ，plugins 定義的很多轉換 ES6 程式碼的套件，比方說以上述程式碼，若是我們想要轉換 箭頭函式則必須安裝以下套件。

``` JavaScript
npm install --save-dev @babel/plugin-transform-arrow-functions
```

然後把剛剛執行的 babel 指令再加上 一些參數進去

```
npx babel source/es6.js --plugins=@babel/plugin-transform-arrow-functions
```

![Alt text](https://firebasestorage.googleapis.com/v0/b/it-blog-a274d.appspot.com/o/babel_2.png?alt=media&token=c1223e9c-1b5f-4737-a954-846c085b735e)

這個時候可以發現到，輸出的結果原本的箭頭函式就被改成傳統函式了，那麼 const 和 let 呢 ? 當然也是必須要安裝相對應的 plugins 套件，才可以進行轉換。

這時候當然會覺得很麻煩，有沒有單純只設定一個參數就可以讓 babel 知道要怎麼轉換 ES6 的所有語法呢 ? 這時候就要依靠最一開始安裝的 @babel/preset-env 套件

## @babel/preset-env
這個套件可以讓我們不用針對自己撰寫的程式碼去找相對應的 plugin 套件各別去設定，執行指令如下

```
npx babel source/es6 --presets=@babel/env
```
![Alt text](https://firebasestorage.googleapis.com/v0/b/it-blog-a274d.appspot.com/o/babel_3.png?alt=media&token=9d8902b9-0278-454d-86b8-692fae257bb2)

這時候可以發現，原本的程式碼，不管是 let、const 或是箭頭函式都被轉換成 var 以及傳統函式，所以使用 @babel/preset-env 可以大幅降低我們開發的時間，因為不用去下載對應的 plugins。

## 最後需要一個設定檔
其實有蠻多的工具或語言，像 eslint、typescript、webpack … 等，他們可以設定的參數非常多，若是我們都在指令上註記這些參數的話，那在開發上會有一點辛苦，所以額外都會有一個檔案會放置這一些設定參數，在執行的時候可以去讀取， 我們先建立一個設定檔 `babel.config.js`

``` JavaScript
module.exports = {
  presets: [
    [
      "@babel/env",
    ],
  ]
}
```

在這個設定檔裡面，有加入我們安裝的 @babel/preset-env 設定，而之後我們在使用指令時，就不用像剛剛打的那麼麻煩

```
npx babel source/es6.js
```

![Alt text](https://firebasestorage.googleapis.com/v0/b/it-blog-a274d.appspot.com/o/babel_4.png?alt=media&token=a0c1ccb5-d6e4-42e6-9af3-1e2e26673917)

這個時候可以發現，我們不用在指令上附加 preset 的參數，最後執行的結果還是可以成功將 ES6 的語法轉成 ES5 的語法。

## 設定檔 target 參數
``` JavaScript
module.exports = {
  presets: [
    [
      "@babel/env",
      {
        targets: {
          edge: "17",
          firefox: "60",
          chrome: "67",
          safari: "11.1",
        },
      },
    ],
  ]
}
```

在 babel.config.js 裡面我們還可以設定要編譯的目標瀏覽器的版本，若是有設定這個參數，preset 會載入在這些瀏覽器不支援的 plugins。

而瀏覽器的版本越新，已經支援到一些 ES6 的語法的話，env 就不會載入如箭頭函式或是 let、const 轉換的套件，來試試看上面這個設定檔