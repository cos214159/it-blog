---
title: webpack 筆記 (3) - Loader
date: 2019-09-18 15:06:34
tags: 
  - webpack
categories: 前端
---

因為 Webpack 預設只能夠打包 JavaScript 和 json 的資料，如果想要額外引入 CSS 或圖片時，必須要再安裝相對應的 loader，這裡會介紹怎麼載入 CSS、以及圖片的資源檔

## 載入 css 檔案
首先要載入 CSS 的檔案，必須要先安裝相對應的 loader

```
npm i --save-dev css-loader style-loader
```

這兩個 loader 的功能如下
* css-loader
主要是要載入 css 的檔案

* style-loader
主要是要將載入過後的 css 檔案注入至 html 的 style tag 裡面

接下來我們要在設定檔裡面增加 loader 設定，在物件 module 底下會有一個 rules 的陣列，在這個陣列裡面放置的每一個物件，是當 Webpack 無法辨識目前要載入的資源檔時會到這邊去查找看看有沒有相對應的載入方式，在這個物件裡面會有兩個屬性

* test
是一個正規表示式，主要是去查找目前要載入的檔案，有沒有跟這個正規表示式符合

* use
表示我們載入檔案要使用的 loader

### module 結構
在我們載入 css 的時候，這個順序不能錯誤，Webpack 有個很特別的地方是他調用 loader 的順序是從後面到前面，也就是說他會先用 css-loader 載入 CSS 檔案後，在使用 style-loader 將 CSS 注入到 HTML 的 style tag 裡面，如果這個 use 的順序 `use: ['css-loader', 'style-loader']` 那這樣 css 會載入錯誤。

``` JavaScript
const path = require('path');
module.exports = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  module: {
    rules: [
      {
        test: /\.css$/,  
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}
```

在設定完 CSS-loader 之後，我們來調整一下 entry 的載入程式，這是我一開始覺得非常奇怪的地方，在一個 JavaScript 裡面引入 CSS 的檔案，卻不是在 HTML 當中引入，不過這個做法其實之後會非常習慣，這樣的檔案結構在經過 webpack 打包之後，在給 index.html 引入就會將定義在 css 的樣式全部注入到 HTML 的 style 標籤裡面

index.js
``` JavaScript
import './js/a';
import './js/b';
import './js/c';

import './css/a.css';
import './css/b.css';
import './css/c.css';
```

## 載入圖片
圖片也不是 Webpack 預設可以處理的資源，所以也必須安裝相對應的 file-loader

``` JavaScript
npm install --save-dev file-loader 
```

跟 css-loader 會有個 test 讓 Webpack 在載入圖片資源時，可以找到對應的 loader 設定，而這邊的 use 就比較特別一點，額外有個 options 的設定

* name
是當我們的圖片原始檔經過打包輸出過後的名稱，[name] 是原檔名 .[ext] 是原副檔名

* publicPath
是當圖片輸出的時候附加在檔名前面的路徑, 整體 url 結構為 host/publicPath/outputPath/imgName

* outputPath
是圖片輸出的資料夾名稱

``` JavaScript
{
  test: /\.(png|jpg|jpeg|svg|gif)$/,
  use: [
    {
      loader: 'file-loader',
      options: {
        name: 'myPrefix.[name].[ext]',
        publicPath: '/dist/images',
        outputPath: 'images/'
      }
    }
  ]
}
```

最後再看一下 index.html 的內容，可以看到我們並沒有引入 css 的檔案，單純只有引入 Webpack 幫我們打包之後的 JavaScript，這樣子最後的結果是有圖片的，而這個也就是 css-loader 和 style-loader 幫我們的忙，而假如我們不想要將 CSS 注入到 HTML 的 style tag 上，是想要額外匯出成一個 css 檔再引入的話，就要再依靠其他的 loader

``` HTML
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
    <div class="bg-dessert"></div>
    <script src="./dist/bundle.js"></script>
  </body>
</html>
```

執行結果

![Alt text](https://firebasestorage.googleapis.com/v0/b/it-blog-a274d.appspot.com/o/%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-18%20%E4%B8%8B%E5%8D%884.09.12.png?alt=media&token=dd9b812d-cfdb-485e-a53f-7e507f6162bc)

範例程式碼 : https://github.com/cos214159/webpack-tutorial/tree/master/chapter3-loader