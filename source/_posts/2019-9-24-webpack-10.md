---
title: webpack 筆記 (10) - code splitting
date: 2019-09-24 15:53:20
tags: 
  - webpack
categories: 前端
---

這一段情境要做一下演練，首先我們先安裝套件 jquery

```
npm i --save jquery
```

然後在三個 .js 裡面都引入這個 jquery 做一些功能

a.js

``` JavaScript
import $ from 'jquery';
$('body').append('<p>aaa</p>');
```

b.js
``` JavaScript
import $ from 'jquery';
$('body').append('<p>bbb</p>');
```

c.js
``` JavaScript
import $ from 'jquery';
$('body').append('<p>ccc</p>');
```

然後我們的設定檔要做一些修改，以往我們的 entry 只有一個進入點，但是要是說我們想說定多個 entry 的話，要將結構修改一下，將他修改為三個 entry 分別對應到上面定義的 .js 檔案

``` JavaScript
module.exports = {
  // entry: './src/index.js',
  entry: {
    bundleA: './src/js/a.js',
    bundleB: './src/js/b.js',
    bundleC: './src/js/c.js'
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
```

這段設定其實會有點問題就是我們在這三隻 .js 檔案裡面都有引入 jquery 函式庫，而 webpack 在打包時，事實上會重複將 jquery 的程式碼包進這三個檔案裏面，並不會知道說這幾隻檔案有共用的 library 因而將他抽出來共用，要做到這件事情，我們必須要在做一些設定。

在設定檔裡面，我們要設定一個新的屬性 splitChunks 在 optimization 裡面，這樣子 Webpack 就可以把共用的部分抽出來共用

``` JavaScript
optimization: {
  splitChunks: {
    chunks: 'all'
  },
  minimizer: [
    new TerserWebpackPlugin(),
    new OptimizeCssAssetsWebpackPlugin()
  ]
},
```

而這支共用的檔案我們可以去客製化他的命名，就是在 ouput 新增一個 chunkFilename 的屬性
``` JavaScript
output: {
  filename: '[name].bundle.js',
  chunkFilename: '[name].shared.js',
  path: path.resolve(__dirname, 'dist')
},
```

如此就不會讓 Webpack 在打包檔案時，有重複打包的情形發生

範例程式碼 : https://github.com/cos214159/webpack-tutorial/tree/master/chapter10-code-splitting